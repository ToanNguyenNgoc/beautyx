"use strict";(self.webpackChunkweb_booking=self.webpackChunkweb_booking||[]).push([[457],{44457:function(e,s,a){a.r(s),a.d(s,{default:function(){return B}});var i=a(99431),l=a(77072),t=a(27565),n=a(34328),d=a(46244),c=a(85698),o={container:"message_container__AxLpV",left:"message_left__k4A+R",left_head:"message_left_head__T--mk",left_head_top:"message_left_head_top__TNK6L",left_head_txt:"message_left_head_txt__MsKN9",left_head_bot:"message_left_head_bot__gwXBX",left_body:"message_left_body__xLWq0",topic:"message_topic__bGPa4",topic_left_img:"message_topic_left_img__s85aR",topic_left_online:"message_topic_left_online__7lGks",topic_right:"message_topic_right__B9HX4",topic_name:"message_topic_name__VZ3tS",topic_message:"message_topic_message__Cxfkf",right:"message_right__T+jke",left_ch:"message_left_ch__pIzTj",right_ch:"message_right_ch__Yr32q"},r=a(58672),m=a(44015),_=a(8426),h=a(96509),g=a(66436),p=a(69896),u=a(30417),v=a(34262),x=a(2742),j=a(77113),A=a(67573),N=a(235),f=a(3936),b=a(27929);const y=(0,t.memo)((e=>{var s,a,l,c,o,h,p,j;let{_id:f,topicProp:y,moreBtn:C}=e;const{USER:B}=(0,i.As)(),I=(0,n.zy)(),R=(0,n.W6)(),M=f||I.pathname.split("/")[2],L=y||I.state,T=(0,t.useRef)(null),{topic_ids:P,connect:$,doMessage:D,onListenerMessage:E,doTyping:X,onListenerTyping:U}=(0,i.ov)(),{response:W}=(0,i.YJ)({API_URL:v.A.ORG(null!==(s=null===L||void 0===L?void 0:L.organization_id)&&void 0!==s?s:0),enable:null===L||void 0===L?void 0:L.organization_id,dedupingInterval:x.nC}),G=(0,_.Am)(null!==(a=null===L||void 0===L||null===(l=L.topic_user)||void 0===l?void 0:l.map((e=>{var s;return null===(s=e.user)||void 0===s?void 0:s.fullname})))&&void 0!==a?a:[]);let K=null===L||void 0===L?void 0:L.name;0!==(null===L||void 0===L||null===(c=L.name)||void 0===c?void 0:c.trim().length)&&null!==L&&void 0!==L&&L.name||(K=G.join(", "));const{resData:V,onLoadMore:q,totalItem:H}=(0,i.wX)({API_URL:"messages",enable:B&&M,keyPage:"p",params:{l:25,sort:"-created_at",topic_id:M},dedupingInterval:0}),O=(0,i.NY)({rootMargin:"100px",threshold:.3},T),[Y,F]=(0,t.useState)([]),[J,Q]=(0,t.useState)(!1);return(0,t.useEffect)((()=>(B&&P.length>0&&(async()=>{await $(),E((e=>{M===e.topic_id&&F((s=>[e,...s]))})),U((e=>{null!==e&&void 0!==e&&e.user&&e.user.id!==B.id&&e.topic_id===M&&Q(e.typing)}))})(),()=>{F([])})),[B,P.length,M]),(0,b.jsxs)("div",{className:u.A.container,children:[(0,b.jsxs)("div",{className:u.A.head,children:[(0,b.jsxs)("div",{className:u.A.head_left,children:[(0,b.jsx)(g.b2,{onClick:()=>R.goBack(),className:u.A.head_left_back,icon:r.A.chevronRightBlack}),(0,b.jsxs)("div",{className:u.A.topic,children:[(0,b.jsx)(A.A,{src:null===L||void 0===L||null===(o=L.organization)||void 0===o?void 0:o.image_url}),(0,b.jsx)("div",{className:u.A.topic_name,children:K})]})]}),(0,b.jsx)("div",{className:u.A.head_right,children:C&&(0,b.jsx)(N.A,{placement:"top-end",title:"Xem t\u1ea5t c\u1ea3 \u0111o\u1ea1n chat",children:(0,b.jsx)("div",{children:(0,b.jsx)(d.N_,{className:u.A.head_right_btn,to:{pathname:`/messages/${M}`},children:(0,b.jsx)("img",{src:r.A.menuWhite,alt:""})})})})})]}),(0,b.jsxs)("div",{id:"scrollableDiv",className:u.A.messages,children:[(0,b.jsx)("div",{ref:T,className:u.A.bottom}),(0,b.jsxs)(m.A,{dataLength:V.length,next:()=>V.length<H&&q(),style:{display:"flex",flexDirection:"column-reverse"},inverse:!0,hasMore:!0,loader:V.length<H&&(0,b.jsx)(z,{}),scrollableTarget:"scrollableDiv",children:[J&&(0,b.jsx)(S,{}),(0,_.zX)(Y).concat(V).map(((e,s)=>(0,b.jsx)("div",{className:u.A.message,children:(0,b.jsx)(k,{item:e,change:e.user_id===B.id,topicProp:y,nameUser:K})},s))),Y.length>0?(0,b.jsxs)("div",{className:u.A.message_default,children:[(0,b.jsxs)("div",{className:u.A.message_info_MC,children:[(0,b.jsx)(A.A,{sx:{width:80,height:80},src:null===L||void 0===L||null===(h=L.organization)||void 0===h?void 0:h.image_url}),(0,b.jsx)("p",{className:u.A.message_info_name,children:K}),(0,b.jsx)(g.b2,{children:(0,b.jsx)(d.N_,{to:{pathname:`/cua-hang/${(null===L||void 0===L||null===(p=L.organization)||void 0===p?void 0:p.subdomain)||(null===L||void 0===L?void 0:L.organization_id)}`},children:"Xem doanh nghi\u1ec7p"})})]}),(0,b.jsxs)("div",{className:u.A.message_head,children:[(0,b.jsx)("div",{className:u.A.avatar,children:(0,b.jsx)("img",{src:null===L||void 0===L||null===(j=L.organization)||void 0===j?void 0:j.image_url,onError:_.fi,alt:""})}),(0,b.jsx)("span",{className:u.A.user_name,children:K})]}),(0,b.jsx)("div",{className:u.A.message_body,children:(0,b.jsx)("div",{className:u.A.message_item_cnt,style:{alignItems:"end"},children:(0,b.jsxs)("p",{style:{backgroundColor:"#f1faff",borderRadius:"8px 0px 8px 8px"},className:u.A.message_body_cnt,children:["Xin ch\xe0o ",G&&G,"! ",K," c\xf3 th\u1ec3 h\u1ed7 tr\u1ee3 g\xec cho anh/ch\u1ecb?"]})})})]}):null]})]}),(0,b.jsx)(w,{doMessage:D,doTyping:X,topic_id:M,onScrollBottom:()=>{T.current&&T.current.scrollIntoView({behavior:"smooth"})},isInScreen:O,org:W,moreBtn:C})]})})),k=e=>{var s,a;let{item:i,change:l=!1,topicProp:t,nameUser:n}=e;return(0,b.jsxs)("div",{className:u.A.message_cnt,children:[(0,b.jsxs)("div",{className:u.A.message_head,style:l?{flexDirection:"row-reverse"}:{},children:[!l&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:u.A.avatar,children:(0,b.jsx)("img",{src:(null===(s=i.user)||void 0===s?void 0:s.avatar)||"",onError:_.fi,alt:""})}),(0,b.jsx)("span",{className:u.A.user_name,children:n})]}),(0,b.jsx)("span",{className:u.A.create,children:(0,_.i1)(i.created_at)})]}),(0,b.jsx)("div",{style:l?{flexDirection:"row-reverse"}:{},className:u.A.message_body,children:(0,b.jsxs)("div",{className:u.A.message_item_cnt,style:{alignItems:l?"end":"start"},children:[(0,b.jsx)("div",{style:l?{backgroundColor:"#f1faff",borderRadius:"8px 0px 8px 8px"}:{},className:u.A.message_body_cnt,dangerouslySetInnerHTML:{__html:(0,_.Bu)(i.msg)}}),i.media_urls&&(null===(a=i.media_urls)||void 0===a?void 0:a.length)>0&&(0,b.jsx)("div",{style:{gridTemplateColumns:`repeat(${i.media_urls.length>=3?3:i.media_urls.length}, 1fr)`,width:""+(t?"18vw":"33vw")},className:u.A.message_body_images,children:i.media_urls.map((e=>(0,b.jsx)("div",{className:u.A.message_body_images_item,children:"IMAGE"===(0,_.xQ)(e)?(0,b.jsx)("img",{src:e,alt:""}):(0,b.jsx)("video",{controls:!0,children:(0,b.jsx)("source",{src:`${e}#t=0.1`})})},e)))})]})})]})},C={_id:"",msg:"",user_id:0,topic_id:"",reply_id:null,updated_at:"",created_at:"",medias:[]},w=e=>{var s;let{doMessage:a=()=>null,doTyping:l=()=>null,topic_id:n,onScrollBottom:d,isInScreen:c,org:o,moreBtn:m}=e;const{handlePostMedia:_}=(0,i._r)(),[h,p]=(0,t.useState)(C),v=(0,t.useRef)(null);(0,t.useEffect)((()=>{v.current&&(v.current.style.height="auto",h.msg.length>0&&(v.current.style.height=v.current.scrollHeight+"px"))}),[h]);const x=async()=>{var e;(h.msg.trim().length>0||h.medias.length>0)&&(a({...h,topic_id:n,reply_id:void 0,media_urls:h.medias.map((e=>e.original_url)),media_ids:h.medias.map((e=>e.model_id))}),p(C),await j.Pt.postMessage({msg:h.msg,media_ids:h.medias.map((e=>e.model_id)),topic_id:n}),null===(e=v.current)||void 0===e||e.blur(),d(),l({topic_id:n,typing:!1}))};return(0,b.jsxs)("div",{className:u.A.input_cnt,children:[(0,b.jsx)(g.b2,{icon:r.A.chevronRightBlack,className:c?u.A.scroll_btn:`${u.A.scroll_btn} ${u.A.scroll_btn_act}`,onClick:d}),(0,b.jsx)("div",{className:u.A.input_cnt_top,children:(0,b.jsx)("div",{className:u.A.input_cnt_top_img,children:null===(s=h.medias)||void 0===s?void 0:s.map((e=>(0,b.jsxs)("div",{className:u.A.input_img_item_cnt,children:[(0,b.jsx)("img",{className:u.A.img_item,src:e.original_url,alt:""}),e.model_id>0?(0,b.jsx)(g.b2,{icon:r.A.closeCircleWhite,iconSize:20,onClick:()=>p({...h,medias:h.medias.filter((s=>s.model_id!==e.model_id))})}):(0,b.jsx)("div",{className:u.A.input_img_item_cnt_load,children:(0,b.jsx)(f.A,{size:22})})]},e.original_url)))})}),(0,b.jsxs)("div",{className:u.A.input_cnt_bot,children:[(0,b.jsxs)("div",{onClick:e=>e.stopPropagation(),className:u.A.ip_ctl,children:[(0,b.jsx)(g.b2,{className:u.A.ip_ctl_btn,iconSize:24,icon:r.A.plus}),!m&&(0,b.jsx)(g.tS,{onChange:e=>{_({e:e,callBack:e=>p({...h,medias:e})})},multiple:!0,iconSize:16,icon:r.A.imageWhite,className:u.A.ip_ctl_btn})]}),(0,b.jsxs)("div",{className:u.A.text_area_cnt,children:[(0,b.jsx)("textarea",{ref:v,onChange:e=>p({...h,msg:e.target.value}),value:h.msg,placeholder:"Aa",rows:1,className:u.A.text_area,onKeyDown:e=>{"Enter"===e.code&&(e.preventDefault(),x())},onFocus:()=>l({topic_id:n,typing:!0}),onBlur:()=>l({topic_id:n,typing:!1})}),(0,b.jsx)(g.b2,{className:u.A.btn_send,icon:h.msg.length>0||h.medias.length>0?r.A.sendWhite:r.A.thumbUpWhite,iconSize:16,onClick:x})]})]})]})},z=()=>(0,b.jsxs)("div",{className:u.A.load,children:["\u0110ang t\u1ea3i...",(0,b.jsx)(f.A,{size:14})]}),S=()=>(0,b.jsx)("div",{className:u.A.chatBubble,children:(0,b.jsxs)("div",{className:u.A.typing,children:[(0,b.jsx)("div",{className:u.A.dot}),(0,b.jsx)("div",{className:u.A.dot}),(0,b.jsx)("div",{className:u.A.dot})]})});var B=function(){const{t:e}=(0,t.useContext)(p.BR),{USER:s}=(0,i.As)(),[a]=(0,t.useState)(l.cu),d=(0,n.zy)(),{onSetDebounceKeyword:_}=(0,i.d7)(),[u,v]=(0,t.useState)(""),x=d.pathname.split("/")[2],{resData:j,onLoadMore:A,totalItem:N,isValidating:f}=(0,i.wX)({API_URL:"topics",enable:s,params:Object.assign(a,{s:u}),dedupingInterval:0});return(0,b.jsxs)("div",{className:o.container,children:[(0,b.jsxs)("div",{className:x?`${o.left} ${o.left_ch}`:o.left,children:[(0,b.jsxs)("div",{className:o.left_head,children:[(0,b.jsxs)("div",{className:o.left_head_top,children:[(0,b.jsx)("span",{className:o.left_head_txt,children:"Chat"}),(0,b.jsx)("div",{className:o.left_head_ctl})]}),(0,b.jsxs)("div",{className:o.left_head_bot,children:[(0,b.jsx)("img",{src:r.A.searchGray,alt:""}),(0,b.jsx)("input",{type:"text",placeholder:"T\xecm ki\u1ebfm trong tin nh\u1eafn...",onChange:e=>{return s=e.target.value,void _({text:s,callback:e=>v(e)});var s}})]})]}),(0,b.jsxs)("div",{className:o.left_body,children:[!f&&0===j.length&&(0,b.jsx)(g.Wy,{isRecommend:!1,title:e("Search_result.emty_message")}),(0,b.jsx)(m.A,{hasMore:!0,height:"calc(100vh - 172px)",dataLength:j.length,loader:j.length<N&&(0,b.jsx)(c.a,{}),next:()=>{j.length<N&&A()},children:(0,b.jsx)("ul",{className:o.topic_list,children:j.map((e=>(0,b.jsx)("li",{className:o.topic_cnt,children:(0,b.jsx)(I,{item:e})},e._id)))})})]})]}),(0,b.jsx)(n.dO,{children:(0,b.jsx)(h.A,{children:(0,b.jsx)(n.qh,{path:"/messages/:_id",children:(0,b.jsx)("div",{style:{backgroundColor:"var(--white)"},className:x?`${o.right} ${o.right_ch}`:o.right,children:(0,b.jsx)(y,{})})})})})]})};const I=e=>{var s,a,i,l;let{item:t}=e;const c=(0,n.zy)();let r=t.name;var m;0!==(null===(s=t.name)||void 0===s?void 0:s.trim().length)&&t.name||(r=(0,_.Am)(null===(m=t.topic_user)||void 0===m?void 0:m.map((e=>{var s;return null===(s=e.user)||void 0===s?void 0:s.fullname})).filter(Boolean)).join(", "));const h=c.pathname.split("/")[2];return(0,b.jsxs)(d.N_,{style:t._id===h?{backgroundColor:"var(--bg-color)"}:{},to:{pathname:`/messages/${t._id}`,state:t},className:o.topic,children:[(0,b.jsx)("div",{className:o.topic_left,children:(0,b.jsxs)("div",{className:o.topic_left_img,children:[(0,b.jsx)("img",{src:(null===(a=t.organization)||void 0===a?void 0:a.image_url)||"",onError:_.fi,alt:""}),(0,b.jsx)("span",{className:o.topic_left_online})]})}),(0,b.jsxs)("div",{className:o.topic_right,children:[(0,b.jsx)("span",{className:o.topic_name,children:(null===(i=t.organization)||void 0===i?void 0:i.name)||r}),(0,b.jsxs)("div",{className:o.topic_message,children:[(0,b.jsx)("span",{children:null===(l=t.messages[0])||void 0===l?void 0:l.msg}),(0,b.jsx)("span",{children:(0,_.i1)(t.updated_at)})]})]})]})}}}]);
//# sourceMappingURL=457.d282af0c.chunk.js.map